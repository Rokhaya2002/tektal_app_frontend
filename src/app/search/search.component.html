<!-- ğŸ”™ Bouton de retour Ã  la page d'accueil -->
<div class="back-wrapper">
  <button class="back-btn" routerLink="/">â† Retour Ã  l'accueil</button>
</div>

<!-- ğŸ” Conteneur principal de la recherche d'itinÃ©raire -->
<div class="search-container">
  <!-- ğŸ–¼ï¸ Logo de l'application -->
  <div class="logo-container">
    <img src="assets/logo2.png" alt="TekTall Logo" />
  </div>

  <!-- ğŸ§­ Titre principal de la page -->
  <h1><i class="fas fa-map-signs"></i> Recherche d'itinÃ©raire</h1>

  <!-- ğŸ“ Formulaire de recherche avec autocomplÃ©tion -->
  <form (ngSubmit)="onSearch()" class="form-container">
    <!-- Champ pour le point de dÃ©part avec autocomplÃ©tion -->
    <div class="input-group">
      <span><i class="fas fa-location-dot"></i></span>
      <input
        type="text"
        placeholder="DÃ©part"
        [(ngModel)]="from"
        name="from"
        (input)="onFromInput()"
        (blur)="closeSuggestions()"
        (focus)="onFromInput()"
        required
        autocomplete="off"
      />
      <!-- Suggestions pour le dÃ©part -->
      <div
        *ngIf="showFromSuggestions && fromSuggestions.length > 0"
        class="suggestions-dropdown"
      >
        <div
          *ngFor="let suggestion of fromSuggestions"
          class="suggestion-item"
          (mousedown)="selectFromSuggestion(suggestion)"
        >
          <i class="fas fa-map-marker-alt"></i>
          {{ suggestion }}
        </div>
      </div>
    </div>

    <!-- Champ pour la destination avec autocomplÃ©tion -->
    <div class="input-group">
      <span><i class="fas fa-flag-checkered"></i></span>
      <input
        type="text"
        placeholder="Destination"
        [(ngModel)]="to"
        name="to"
        (input)="onToInput()"
        (blur)="closeSuggestions()"
        (focus)="onToInput()"
        required
        autocomplete="off"
      />
      <!-- Suggestions pour la destination -->
      <div
        *ngIf="showToSuggestions && toSuggestions.length > 0"
        class="suggestions-dropdown"
      >
        <div
          *ngFor="let suggestion of toSuggestions"
          class="suggestion-item"
          (mousedown)="selectToSuggestion(suggestion)"
        >
          <i class="fas fa-map-marker-alt"></i>
          {{ suggestion }}
        </div>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="form-actions">
      <button type="submit" class="search-btn">
        <i class="fas fa-search"></i> Rechercher
      </button>
      <button type="button" class="history-btn" (click)="toggleHistory()">
        <i class="fas fa-history"></i> Historique
      </button>
    </div>
  </form>

  <!-- ğŸ“š Historique de recherche -->
  <div *ngIf="showHistory" class="history-section">
    <div class="history-header">
      <h3><i class="fas fa-history"></i> Historique de recherche</h3>
      <button class="clear-history-btn" (click)="clearHistory()">
        <i class="fas fa-trash"></i> Effacer
      </button>
    </div>

    <!-- Suggestions basÃ©es sur l'historique -->
    <div *ngIf="historySuggestions.length > 0" class="history-suggestions">
      <h4><i class="fas fa-lightbulb"></i> Suggestions populaires</h4>
      <div class="suggestion-chips">
        <span
          *ngFor="let suggestion of historySuggestions"
          class="suggestion-chip"
          (click)="from = suggestion; onSearch()"
        >
          {{ suggestion }}
        </span>
      </div>
    </div>

    <!-- Liste des recherches rÃ©centes -->
    <div *ngIf="searchHistory.length > 0" class="recent-searches">
      <h4><i class="fas fa-clock"></i> Recherches rÃ©centes</h4>
      <div class="history-list">
        <div
          *ngFor="let item of searchHistory.slice(0, 8)"
          class="history-item"
          (click)="selectFromHistory(item)"
        >
          <div class="history-route">
            <span class="from">{{ item.from }}</span>
            <i class="fas fa-arrow-right"></i>
            <span class="to">{{ item.to }}</span>
          </div>
          <div class="history-meta">
            <span class="history-date">{{
              formatHistoryDate(item.last_searched_at)
            }}</span>
            <span *ngIf="item.count > 1" class="search-count">
              {{ item.count }} fois
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si pas d'historique -->
    <div *ngIf="searchHistory.length === 0" class="no-history">
      <p><i class="fas fa-info-circle"></i> Aucune recherche rÃ©cente</p>
      <p>
        Vos recherches apparaÃ®tront ici pour vous aider Ã  retrouver rapidement
        vos trajets favoris.
      </p>
    </div>
  </div>

  <!-- ğŸ”„ Suggestions en temps rÃ©el -->
  <div *ngIf="from && to && results.length > 0" class="realtime-suggestions">
    <h3>ğŸ’¡ Suggestions en temps rÃ©el</h3>
    <p>DÃ¨s que vous tapez, nous trouvons les meilleures lignes pour vous !</p>
  </div>

  <!-- âœ… Affichage des rÃ©sultats s'ils existent -->
  <div *ngIf="results.length > 0" class="results">
    <h2><i class="fas fa-road"></i> Trajets trouvÃ©s ({{ results.length }})</h2>

    <!-- ğŸ” Boucle sur chaque ligne trouvÃ©e -->
    <div class="line-card" *ngFor="let line of results">
      <div class="line-header">
        <h3><i class="fas fa-bus"></i> {{ line.name }}</h3>
        <span class="direction-badge" [class.reversed]="line.reversed">
          {{ line.reversed ? "ğŸ”„ Retour" : "â¡ï¸ Aller" }}
        </span>
      </div>

      <div class="line-route">
        <p>
          <strong>Trajet :</strong> {{ line.departure }} â†’
          {{ line.destination }}
        </p>
        <p *ngIf="line.stops_count" class="stops-info">
          <i class="fas fa-map-pin"></i> {{ line.stops_count }} arrÃªts
        </p>
      </div>

      <!-- ğŸ”— Lien vers la page de dÃ©tails de la ligne -->
      <a [routerLink]="['/line', line.id]" class="details-btn"
        >Voir les dÃ©tails</a
      >
    </div>
  </div>

  <!-- âŒ Message affichÃ© si aucun rÃ©sultat trouvÃ© -->
  <div *ngIf="noResult" class="no-result">
    <p><i class="fas fa-face-frown"></i> ğŸ˜ Aucun trajet trouvÃ©</p>
    <p class="help-text">
      Essayez avec d'autres arrÃªts ou vÃ©rifiez l'orthographe
    </p>
  </div>

  <!-- ğŸ’¡ Conseils d'utilisation -->
  <div class="tips-section">
    <h3>ğŸ’¡ Conseils d'utilisation</h3>
    <ul>
      <li>Commencez Ã  taper pour voir les suggestions d'arrÃªts</li>
      <li>Les suggestions apparaissent aprÃ¨s 2 caractÃ¨res</li>
      <li>Cliquez sur une suggestion pour la sÃ©lectionner</li>
      <li>La recherche se fait automatiquement en temps rÃ©el</li>
      <li>Consultez votre historique pour retrouver vos recherches rÃ©centes</li>
    </ul>
  </div>
</div>
